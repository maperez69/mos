<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MOS - Reporte de Ventas</title>
    
    <!-- Meta tags para iPhone (Web App) -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mos Ventas">
    
    <!-- Librerías con dependencias corregidas -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
            --mos-indigo: #4f46e5;
            --mos-bg: #F9FAFB;
        }

        body { 
            background-color: var(--mos-bg); 
            font-family: 'Inter', -apple-system, sans-serif;
            -webkit-user-select: none;
            user-select: none;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            color: #111827;
        }

        .ios-blur {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
        }

        .chart-container { height: 320px; width: 100%; }
        
        .fade-in { animation: fadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        .card-mos {
            background: white;
            border-radius: 28px;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .recharts-default-tooltip { 
            border-radius: 18px !important; 
            border: none !important; 
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.12) !important;
            font-size: 11px !important;
            padding: 14px !important;
            background: rgba(255, 255, 255, 0.98) !important;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .mos-logo {
            letter-spacing: 0.4em;
            font-weight: 800;
            color: #111827;
            font-size: 1.1rem;
        }

        .active-tab-indicator {
            position: absolute;
            bottom: -10px;
            width: 4px;
            height: 4px;
            background: var(--mos-indigo);
            border-radius: 50%;
        }
    </style>
</head>
<body class="pb-32">
    <div id="root"></div>

    <script type="text/javascript">
        const { useState, useMemo, useEffect } = React;
        const { 
            BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, 
            AreaChart, Area, Cell
        } = Recharts;

        const DATA = {
            resumen: {
                Todas: { ene: 1036091.6, dic: 1088444, nov: 1294981, t_ene: 215, t_dic: 224, t_nov: 245, tick_ene: 4819, tick_dic: 4859, tick_nov: 5285 },
                Buenavista: { ene: 797114.9, dic: 783083, nov: 722637, t_ene: 162, t_dic: 158, t_nov: 142, tick_ene: 4920, tick_dic: 4956, tick_nov: 5089 },
                Masaryk: { ene: 238976.7, dic: 305361, nov: 572343, t_ene: 53, t_dic: 66, t_nov: 103, tick_ene: 4509, tick_dic: 4626, tick_nov: 5556 }
            },
            departamentos: [
                { name: 'Medicina Estética', sucursal: 'Buenavista', ene: 313940, dic: 437780, nov: 266910 },
                { name: 'Aparatología', sucursal: 'Buenavista', ene: 115787, dic: 132920, nov: 226470 },
                { name: 'Farmacia', sucursal: 'Buenavista', ene: 146087, dic: 99663, nov: 99970 },
                { name: 'Stellar M22', sucursal: 'Buenavista', ene: 34900, dic: 51820, nov: 79280 },
                { name: 'Cosmetología', sucursal: 'Buenavista', ene: 22800, dic: 25400, nov: 11170 },
                { name: 'Membresía', sucursal: 'Buenavista', ene: 149000, dic: 12500, nov: 1500 },
                { name: 'Aparatología', sucursal: 'Masaryk', ene: 26000, dic: 81134, nov: 290080 },
                { name: 'Medicina Estética', sucursal: 'Masaryk', ene: 100720, dic: 73600, nov: 147885 },
                { name: 'Farmacia', sucursal: 'Masaryk', ene: 56156, dic: 65695, nov: 49798 },
                { name: 'Cosmetología', sucursal: 'Masaryk', ene: 14300, dic: 31632, nov: 17980 },
                { name: 'Membresía', sucursal: 'Masaryk', ene: 28800, dic: 28800, nov: 0 }
            ],
            vendedores: [
                { name: 'Mar Campos', sucursal: 'Buenavista', ene: 358871, dic: 451356, nov: 319608 },
                { name: 'Aura Castro', sucursal: 'Buenavista', ene: 97668, dic: 130407, nov: 82956 },
                { name: 'Samantha Glez', sucursal: 'Buenavista', ene: 86666, dic: 51601, nov: 78860 },
                { name: 'Hanna Esquivel', sucursal: 'Buenavista', ene: 35064, dic: 14858, nov: 23003 },
                { name: 'Buenavista Gral', sucursal: 'Buenavista', ene: 218843, dic: 127239, nov: 118850 },
                { name: 'Recep. Masaryk', sucursal: 'Masaryk', ene: 58872, dic: 70963, nov: 57805 },
                { name: 'Daniela Pérez', sucursal: 'Masaryk', ene: 31153, dic: 69906, nov: 134101 },
                { name: 'Paulina', sucursal: 'Masaryk', ene: 26427, dic: 62530, nov: 157176 },
                { name: 'Adriana Álvarez', sucursal: 'Masaryk', ene: 23620, dic: 40800, nov: 28405 },
                { name: 'Itzel Bravo', sucursal: 'Masaryk', ene: 20433, dic: 20911, nov: 55918 }
            ],
            productos: [
                { name: 'Liftera C+C', sucursal: 'Buenavista', ene: 112000, dic: 105600, nov: 85400 },
                { name: 'Toxina 3Z', sucursal: 'Buenavista', ene: 85000, dic: 98000, nov: 112000 },
                { name: 'Filler Labios', sucursal: 'Buenavista', ene: 38000, dic: 42500, nov: 35000 },
                { name: 'Hydrafacial', sucursal: 'Masaryk', ene: 31000, dic: 24600, nov: 18000 },
                { name: 'Toxina 3Z (M)', sucursal: 'Masaryk', ene: 28000, dic: 35000, nov: 45000 }
            ],
            historico: [
                { mes: 'Noviembre', Buenavista: 722637, Masaryk: 572343, Todas: 1294980 },
                { mes: 'Diciembre', Buenavista: 783083, Masaryk: 305361, Todas: 1088444 },
                { mes: 'Enero', Buenavista: 797115, Masaryk: 238977, Todas: 1036092 }
            ]
        };

        const App = () => {
            const [activeSucursal, setActiveSucursal] = useState('Todas');
            const [activeMonth, setActiveMonth] = useState('Enero'); 
            const [activeTab, setActiveTab] = useState('depto');
            
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeSucursal, activeMonth, activeTab]);

            const formatCurrency = (val) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', maximumFractionDigits: 0 }).format(val);

            const stats = DATA.resumen[activeSucursal];
            
            // Lógica de valores según mes
            const currentVal = activeMonth === 'Enero' ? stats.ene : activeMonth === 'Diciembre' ? stats.dic : stats.nov;
            const prevVal = activeMonth === 'Enero' ? stats.dic : activeMonth === 'Diciembre' ? stats.nov : null;
            
            const currentTrans = activeMonth === 'Enero' ? stats.t_ene : activeMonth === 'Diciembre' ? stats.t_dic : stats.t_nov;
            const currentTicket = activeMonth === 'Enero' ? stats.tick_ene : activeMonth === 'Diciembre' ? stats.tick_dic : stats.tick_nov;

            const comparisonData = useMemo(() => {
                let source = activeTab === 'depto' ? DATA.departamentos : activeTab === 'vendedor' ? DATA.vendedores : DATA.productos;
                const grouped = {};
                source.forEach(item => {
                    if (activeSucursal === 'Todas' || item.sucursal === activeSucursal) {
                        if (!grouped[item.name]) grouped[item.name] = { name: item.name, ene: 0, dic: 0, nov: 0 };
                        grouped[item.name].ene += (item.ene || 0);
                        grouped[item.name].dic += (item.dic || 0);
                        grouped[item.name].nov += (item.nov || 0);
                    }
                });
                return Object.values(grouped)
                    .map(item => {
                        const cur = activeMonth === 'Enero' ? item.ene : activeMonth === 'Diciembre' ? item.dic : item.nov;
                        const pre = activeMonth === 'Enero' ? item.dic : activeMonth === 'Diciembre' ? item.nov : null;
                        return { 
                            ...item, 
                            current: cur, 
                            previous: pre,
                            growth: pre > 0 ? ((cur - pre) / pre) * 100 : 0 
                        };
                    })
                    .sort((a, b) => b.current - a.current)
                    .slice(0, 6);
            }, [activeSucursal, activeTab, activeMonth]);

            return React.createElement('div', { className: 'min-h-screen' }, [
                
                // HEADER MOS STYLE
                React.createElement('div', { key: 'nav', className: 'sticky top-0 z-50 ios-blur pt-[env(safe-area-inset-top,20px)] border-b border-slate-100' }, [
                    React.createElement('div', { className: 'px-6 py-6 flex flex-col gap-6' }, [
                        React.createElement('div', { className: 'flex justify-between items-start' }, [
                            React.createElement('div', null, [
                                React.createElement('div', { className: 'mos-logo mb-1' }, 'MOS'),
                                React.createElement('h1', { className: 'text-2xl font-extrabold text-slate-900 tracking-tight' }, 'Reporte de Ventas'),
                                React.createElement('div', { className: 'flex items-center gap-2 mt-1' }, [
                                    React.createElement('span', { className: 'w-1.5 h-1.5 rounded-full bg-indigo-500' }),
                                    React.createElement('p', { className: 'text-[11px] font-bold text-slate-500 uppercase tracking-widest' }, `${activeSucursal} • ${activeMonth} 2026`)
                                ])
                            ]),
                            // SELECTOR DE MES
                            React.createElement('div', { className: 'flex bg-slate-50 p-1 rounded-full border border-slate-100 overflow-x-auto no-scrollbar max-w-[140px]' }, 
                                ['Noviembre', 'Diciembre', 'Enero'].map(m => React.createElement('button', {
                                    key: m,
                                    onClick: () => setActiveMonth(m),
                                    className: `px-3 py-1.5 rounded-full text-[10px] font-bold transition-all whitespace-nowrap ${activeMonth === m ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`
                                }, m.substring(0,3)))
                            )
                        ]),
                        // SELECTOR DE SUCURSAL
                        React.createElement('div', { className: 'flex gap-3 overflow-x-auto no-scrollbar' }, 
                            ['Todas', 'Buenavista', 'Masaryk'].map(s => React.createElement('button', {
                                key: s,
                                onClick: () => setActiveSucursal(s),
                                className: `flex-none px-6 py-2.5 rounded-2xl text-[11px] font-extrabold transition-all border ${activeSucursal === s ? 'bg-slate-900 border-slate-900 text-white shadow-xl shadow-slate-200' : 'bg-white border-slate-100 text-slate-500'}`
                            }, s))
                        )
                    ])
                ]),

                // CONTENIDO
                React.createElement('main', { key: 'main', className: 'px-6 pt-6 space-y-6 fade-in' }, [
                    
                    // MÉTRICAS
                    React.createElement('div', { className: 'grid grid-cols-2 gap-4' }, [
                        { label: 'Facturación', val: formatCurrency(currentVal), color: 'text-slate-900' },
                        { label: 'Crecimiento', val: prevVal ? `${(((currentVal-prevVal)/prevVal)*100).toFixed(0)}%` : '-', color: 'text-indigo-600' },
                        { label: 'Ticket Medio', val: formatCurrency(currentTicket), color: 'text-slate-900' },
                        { label: 'Transacciones', val: currentTrans, color: 'text-slate-900' }
                    ].map(kpi => React.createElement('div', { key: kpi.label, className: 'card-mos p-6' }, [
                        React.createElement('p', { className: 'text-[9px] font-black text-slate-400 uppercase tracking-[0.2em] mb-2' }, kpi.label),
                        React.createElement('h3', { className: `text-lg font-black ${kpi.color} tracking-tight` }, kpi.val)
                    ]))),

                    // GRÁFICO
                    React.createElement('div', { className: 'card-mos p-6' }, [
                        React.createElement('div', { className: 'flex justify-between items-center mb-8' }, [
                            React.createElement('h3', { className: 'text-[10px] font-black text-slate-800 uppercase tracking-[0.2em]' }, 'Análisis de Rendimiento'),
                            activeMonth !== 'Noviembre' && React.createElement('div', { className: 'flex gap-2' }, [
                                React.createElement('div', { className: 'w-2 h-2 bg-slate-100 rounded-full' }),
                                React.createElement('div', { className: 'w-2 h-2 bg-indigo-500 rounded-full' })
                            ])
                        ]),
                        React.createElement('div', { className: 'h-[260px]' }, 
                            React.createElement(ResponsiveContainer, null, 
                                React.createElement(BarChart, { data: comparisonData, layout: 'vertical', margin: { left: -5, right: 10 } }, [
                                    React.createElement(XAxis, { type: 'number', hide: true }),
                                    React.createElement(YAxis, { dataKey: 'name', type: 'category', width: 100, axisLine: false, tickLine: false, tick: {fill: '#94a3b8', fontSize: 10, fontWeight: 700} }),
                                    React.createElement(Tooltip, { formatter: v => formatCurrency(v), cursor: {fill: '#F9FAFB', radius: 12} }),
                                    
                                    activeMonth !== 'Noviembre' ? [
                                        React.createElement(Bar, { key: 'p', dataKey: 'previous', fill: '#F1F5F9', radius: [0, 8, 8, 0], barSize: 8 }),
                                        React.createElement(Bar, { key: 'c', dataKey: 'current', fill: '#4f46e5', radius: [0, 8, 8, 0], barSize: 8 })
                                    ] : 
                                    React.createElement(Bar, { dataKey: 'current', fill: '#4f46e5', radius: [0, 10, 10, 0], barSize: 20 })
                                ])
                            )
                        )
                    ]),

                    // LISTADO
                    React.createElement('div', { className: 'space-y-4 pb-8' }, [
                        React.createElement('h3', { className: 'text-[10px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2' }, `Ranking ${activeTab === 'depto' ? 'Departamentos' : activeTab === 'vendedor' ? 'Vendedores' : 'Servicios'}`),
                        comparisonData.map((item, i) => React.createElement('div', { key: item.name, className: 'card-mos p-5 flex justify-between items-center active:scale-[0.98] transition-transform' }, [
                            React.createElement('div', { className: 'flex items-center gap-4' }, [
                                React.createElement('span', { className: 'text-xs font-black text-slate-200' }, `0${i+1}`),
                                React.createElement('div', null, [
                                    React.createElement('p', { className: 'text-xs font-bold text-slate-900 leading-none' }, item.name),
                                    activeMonth !== 'Noviembre' && React.createElement('p', { className: 'text-[9px] font-bold text-slate-400 mt-1.5 uppercase' }, `Anterior: ${formatCurrency(item.previous)}`)
                                ])
                            ]),
                            React.createElement('div', { className: 'text-right' }, [
                                React.createElement('p', { className: 'text-xs font-black text-slate-900' }, formatCurrency(item.current)),
                                activeMonth !== 'Noviembre' && React.createElement('div', { className: `flex items-center justify-end gap-1 mt-1 ${item.growth >= 0 ? 'text-emerald-500' : 'text-rose-500'}` }, [
                                    React.createElement('span', { className: 'text-[10px] font-black' }, `${item.growth > 0 ? '+' : ''}${item.growth.toFixed(0)}%`)
                                ])
                            ])
                        ]))
                    ])
                ]),

                // TAB BAR MOS STYLE
                React.createElement('nav', { key: 'footer-nav', className: 'fixed bottom-0 left-0 right-0 ios-blur border-t border-slate-100 px-10 pt-5 pb-[env(safe-area-inset-bottom,30px)] flex justify-between items-center z-50' }, [
                    { id: 'depto', label: 'Deptos', icon: 'layers' },
                    { id: 'vendedor', label: 'Vendedores', icon: 'users' },
                    { id: 'producto', label: 'Servicios', icon: 'star' }
                ].map(tab => {
                    const isActive = activeTab === tab.id;
                    return React.createElement('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `relative flex flex-col items-center gap-1.5 transition-all ${isActive ? 'text-indigo-600' : 'text-slate-300'}`
                    }, [
                        React.createElement('i', { 'data-lucide': tab.icon, size: 22, className: isActive ? 'stroke-[2.5px]' : 'stroke-[2px]' }),
                        React.createElement('span', { className: 'text-[9px] font-black uppercase tracking-widest' }, tab.label),
                        isActive && React.createElement('div', { className: 'active-tab-indicator' })
                    ])
                }))
            ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
