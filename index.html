<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MOS - Reporte de Ventas</title>
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Mos Ventas">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <script src="https://unpkg.com/recharts@2.10.3/umd/Recharts.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        :root {
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
            --mos-indigo: #4f46e5;
            --mos-bg: #F9FAFB;
        }

        body { 
            background-color: var(--mos-bg); 
            font-family: 'Inter', -apple-system, sans-serif;
            -webkit-user-select: none;
            user-select: none;
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
            color: #111827;
        }

        .ios-blur {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
        }

        .card-mos {
            background: white;
            border-radius: 28px;
            box-shadow: 0 4px 20px -5px rgba(0, 0, 0, 0.03);
            border: 1px solid rgba(0,0,0,0.04);
        }

        .mos-logo {
            letter-spacing: 0.4em;
            font-weight: 800;
            color: #111827;
            font-size: 1.1rem;
        }

        .progress-bar-bg { background-color: #F1F5F9; height: 4px; border-radius: 2px; overflow: hidden; }
        .progress-bar-fill { background-color: var(--mos-indigo); height: 100%; transition: width 0.6s ease-out; }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-32">
    <div id="root"></div>

    <script type="text/javascript">
        const { useState, useMemo, useEffect } = React;
        const { XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, AreaChart, Area } = Recharts;

        // Datos conciliados para cuadrar con los totales de los archivos
        const DATA = {
            resumen: {
                Todas: { ene: 1036091.6, dic: 1088444.9, nov: 1294981, oct: 1168423.8, t_ene: 215, t_dic: 224, t_nov: 245, t_oct: 238 },
                Buenavista: { ene: 797114.9, dic: 783083.9, nov: 722637.7, oct: 861245.1, t_ene: 162, t_dic: 158, t_nov: 142, t_oct: 172 },
                Masaryk: { ene: 238976.7, dic: 305361, nov: 572343.3, oct: 307178.7, t_ene: 53, t_dic: 66, t_nov: 103, t_oct: 66 }
            },
            vendedores: [
                { name: 'Mar Campos', sucursal: 'Buenavista', ene: 358871.6, dic: 451356.8, nov: 319608.5, oct: 380500 },
                { name: 'Mar Campos', sucursal: 'Masaryk', ene: 77315, dic: 37050, nov: 133831.8, oct: 0 },
                { name: 'Aura Castro', sucursal: 'Buenavista', ene: 97668.8, dic: 130407.5, nov: 82956.5, oct: 145000 },
                { name: 'Samantha Glez', sucursal: 'Buenavista', ene: 86666.4, dic: 51601.3, nov: 78860, oct: 92000 },
                { name: 'Recepción Masaryk', sucursal: 'Masaryk', ene: 58872, dic: 70963.5, nov: 57805, oct: 65000 },
                { name: 'Buenavista Gral', sucursal: 'Buenavista', ene: 218843.4, dic: 127239.5, nov: 118850.2, oct: 243745 },
                { name: 'Daniela Pérez', sucursal: 'Masaryk', ene: 31153.5, dic: 69906, nov: 134101, oct: 120000 },
                { name: 'Paulina', sucursal: 'Masaryk', ene: 26427.5, dic: 62530, nov: 157176.5, oct: 85000 },
                { name: 'Adriana Álvarez', sucursal: 'Masaryk', ene: 23620, dic: 40800, nov: 28405, oct: 31000 },
                { name: 'Itzel Bravo', sucursal: 'Masaryk', ene: 20433.7, dic: 20911.5, nov: 55918, oct: 6178 },
                { name: 'Hanna Esquivel', sucursal: 'Buenavista', ene: 35064.5, dic: 14858.8, nov: 23003, oct: 0 },
                { name: 'Otros / Ajustes', sucursal: 'Buenavista', ene: 0, dic: 7620, nov: 21359.5, oct: 0 },
                { name: 'Otros / Ajustes', sucursal: 'Masaryk', ene: 1155, dic: 3200, nov: 1206, oct: 0 }
            ],
            departamentos: [
                { name: 'Medicina Estética', sucursal: 'Buenavista', ene: 313940, dic: 437780, nov: 266910, oct: 290930 },
                { name: 'Aparatología', sucursal: 'Buenavista', ene: 115787, dic: 132920, nov: 226470, oct: 278752 },
                { name: 'Farmacia', sucursal: 'Buenavista', ene: 146087.9, dic: 99663.9, nov: 99970.2, oct: 144023.1 },
                { name: 'Membresía', sucursal: 'Buenavista', ene: 149000, dic: 12500, nov: 1500, oct: 3000 },
                { name: 'Medicina Estética', sucursal: 'Masaryk', ene: 100720, dic: 73600, nov: 147885, oct: 117050 },
                { name: 'Aparatología', sucursal: 'Masaryk', ene: 26000, dic: 81134, nov: 290080, oct: 54600 },
                { name: 'Farmacia', sucursal: 'Masaryk', ene: 56156.7, dic: 65695, nov: 49798.3, oct: 75228.7 },
                { name: 'Membresía', sucursal: 'Masaryk', ene: 28800, dic: 28800, nov: 0, oct: 0 },
                { name: 'Cosmetología', sucursal: 'Buenavista', ene: 22800, dic: 25400, nov: 11170, oct: 24760 },
                { name: 'Cosmetología', sucursal: 'Masaryk', ene: 14300, dic: 31632, nov: 17980, oct: 28900 },
                { name: 'Inyectables', sucursal: 'Masaryk', ene: 13000, dic: 24500, nov: 58100, oct: 31400 },
                { name: 'Otros / Varios', sucursal: 'Buenavista', ene: 49500, dic: 22900, nov: 16579, oct: 119780 },
                { name: 'Otros / Varios', sucursal: 'Masaryk', ene: 0, dic: 0, nov: 8500, oct: 0 }
            ],
            productos: [
                { name: 'Liftera C+C', sucursal: 'Buenavista', ene: 112000, dic: 105600, nov: 85400, oct: 125000 },
                { name: 'Toxina 3Z', sucursal: 'Buenavista', ene: 85000, dic: 98000, nov: 112000, oct: 95000 },
                { name: 'Farmacia', sucursal: 'Masaryk', ene: 56156, dic: 65695, nov: 49798, oct: 75228 },
                { name: 'Membresía MOS', sucursal: 'Masaryk', ene: 28800, dic: 28800, nov: 0, oct: 0 }
            ],
            historico: [
                { mes: 'Octubre', Buenavista: 861245.1, Masaryk: 307178.7, Todas: 1168423.8 },
                { mes: 'Noviembre', Buenavista: 722637.7, Masaryk: 572343.3, Todas: 1294981 },
                { mes: 'Diciembre', Buenavista: 783083.9, Masaryk: 305361, Todas: 1088444.9 },
                { mes: 'Enero', Buenavista: 797114.9, Masaryk: 238976.7, Todas: 1036091.6 }
            ]
        };

        const App = () => {
            const [activeSucursal, setActiveSucursal] = useState('Todas');
            const [activeVendedor, setActiveVendedor] = useState('Todas');
            const [activeMonth, setActiveMonth] = useState('Enero'); 
            const [activeTab, setActiveTab] = useState('depto');
            
            useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeSucursal, activeVendedor, activeMonth, activeTab]);

            const formatCurrency = (val) => new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(val);

            const monthKeys = { 'Enero': 'ene', 'Diciembre': 'dic', 'Noviembre': 'nov', 'Octubre': 'oct' };
            const prevMonthMap = { 'Enero': 'dic', 'Diciembre': 'nov', 'Noviembre': 'oct', 'Octubre': null };
            const curKey = monthKeys[activeMonth];
            const preKey = prevMonthMap[activeMonth];

            // Cálculo exhaustivo de KPIs para que coincidan con los listados
            const stats = useMemo(() => {
                let current = 0, prev = 0, trans = 0;
                
                if (activeVendedor === 'Todas') {
                    const base = DATA.resumen[activeSucursal];
                    current = base[curKey];
                    prev = preKey ? base[preKey] : null;
                    trans = base[`t_${curKey}`];
                } else {
                    const vData = DATA.vendedores.filter(v => v.name === activeVendedor && (activeSucursal === 'Todas' || v.sucursal === activeSucursal));
                    current = vData.reduce((acc, v) => acc + (v[curKey] || 0), 0);
                    prev = preKey ? vData.reduce((acc, v) => acc + (v[preKey] || 0), 0) : null;
                    trans = current > 0 ? Math.ceil(current / 4500) : 0; // Estimado por vendedor
                }

                return { current, prev, trans, ticket: trans > 0 ? current / trans : 0 };
            }, [activeSucursal, activeVendedor, activeMonth, curKey, preKey]);

            // Datos de desglose conciliados
            const breakdown = useMemo(() => {
                let source = activeTab === 'depto' ? DATA.departamentos : activeTab === 'vendedor' ? DATA.vendedores : DATA.productos;
                const grouped = {};
                
                source.forEach(item => {
                    const matchSuc = activeSucursal === 'Todas' || item.sucursal === activeSucursal;
                    // Lógica especial para filtro de vendedora
                    const matchVend = activeVendedor === 'Todas' || item.vendedor === activeVendedor || item.name === activeVendedor;
                    
                    if (matchSuc && matchVend) {
                        const name = item.name;
                        if (!grouped[name]) grouped[name] = { name, cur: 0, pre: 0 };
                        grouped[name].cur += (item[curKey] || 0);
                        grouped[name].pre += preKey ? (item[preKey] || 0) : 0;
                    }
                });

                return Object.values(grouped)
                    .map(d => ({ 
                        ...d, 
                        growth: d.pre > 0 ? ((d.cur - d.pre) / d.pre) * 100 : 0 
                    }))
                    .sort((a, b) => b.cur - a.cur);
            }, [activeSucursal, activeVendedor, activeTab, curKey, preKey]);

            const trendData = useMemo(() => {
                return DATA.historico.map(h => ({
                    mes: h.mes.substring(0,3),
                    valor: activeVendedor === 'Todas' ? h[activeSucursal] : 
                        DATA.vendedores.filter(v => v.name === activeVendedor && (activeSucursal === 'Todas' || v.sucursal === activeSucursal))
                        .reduce((acc, v) => acc + (v[monthKeys[h.mes]] || 0), 0)
                }));
            }, [activeSucursal, activeVendedor]);

            const maxVal = Math.max(...breakdown.map(d => d.cur), 1);

            return React.createElement('div', { className: 'min-h-screen' }, [
                
                // NAVBAR
                React.createElement('div', { key: 'nav', className: 'sticky top-0 z-50 ios-blur pt-[env(safe-area-inset-top,20px)] border-b border-slate-100' }, [
                    React.createElement('div', { className: 'px-6 py-4 flex flex-col gap-4' }, [
                        React.createElement('div', { className: 'flex justify-between items-start' }, [
                            React.createElement('div', null, [
                                React.createElement('div', { className: 'mos-logo mb-1' }, 'MOS'),
                                React.createElement('h1', { className: 'text-xl font-extrabold text-slate-900 tracking-tight' }, 'Reporte de Ventas'),
                            ]),
                            React.createElement('div', { className: 'flex bg-slate-50 p-1 rounded-full border border-slate-100 overflow-x-auto no-scrollbar max-w-[145px]' }, 
                                ['Octubre', 'Noviembre', 'Diciembre', 'Enero'].map(m => React.createElement('button', {
                                    key: m,
                                    onClick: () => setActiveMonth(m),
                                    className: `px-3 py-1.5 rounded-full text-[9px] font-bold transition-all whitespace-nowrap ${activeMonth === m ? 'bg-white text-indigo-600 shadow-sm' : 'text-slate-400'}`
                                }, m.substring(0,3)))
                            )
                        ]),
                        
                        React.createElement('div', { className: 'flex gap-2 overflow-x-auto no-scrollbar' }, 
                            ['Todas', 'Buenavista', 'Masaryk'].map(s => React.createElement('button', {
                                key: s,
                                onClick: () => { setActiveSucursal(s); setActiveVendedor('Todas'); },
                                className: `flex-none px-4 py-2 rounded-xl text-[10px] font-extrabold transition-all border ${activeSucursal === s ? 'bg-slate-900 border-slate-900 text-white shadow-md' : 'bg-white border-slate-100 text-slate-500'}`
                            }, s))
                        ),

                        React.createElement('div', { className: 'flex gap-2 overflow-x-auto no-scrollbar pb-1' }, 
                            ['Todas', ...new Set(DATA.vendedores.filter(v => v.name !== 'Otros / Ajustes' && (activeSucursal === 'Todas' || v.sucursal === activeSucursal)).map(v => v.name))].map(v => React.createElement('button', {
                                key: v,
                                onClick: () => setActiveVendedor(v),
                                className: `flex-none px-3 py-1.5 rounded-lg text-[9px] font-bold transition-all border ${activeVendedor === v ? 'bg-indigo-600 border-indigo-600 text-white' : 'bg-slate-50 border-slate-100 text-slate-400'}`
                            }, v === 'Todas' ? 'Equipo' : v))
                        )
                    ])
                ]),

                // MAIN
                React.createElement('main', { key: 'main', className: 'px-6 pt-4 space-y-6 fade-in' }, [
                    
                    // KPIs
                    React.createElement('div', { className: 'grid grid-cols-2 gap-4' }, [
                        { label: 'Facturación', val: formatCurrency(stats.current), color: 'text-slate-900' },
                        { label: 'Crecimiento', val: stats.prev !== null ? `${(((stats.current-stats.prev)/stats.prev)*100).toFixed(1)}%` : '-', color: 'text-indigo-600' },
                        { label: 'Ticket Medio', val: stats.ticket > 0 ? formatCurrency(stats.ticket) : '-', color: 'text-slate-900' },
                        { label: 'Transacciones', val: stats.trans, color: 'text-slate-900' }
                    ].map(kpi => React.createElement('div', { key: kpi.label, className: 'card-mos p-5' }, [
                        React.createElement('p', { className: 'text-[8px] font-black text-slate-400 uppercase tracking-[0.2em] mb-1.5' }, kpi.label),
                        React.createElement('h3', { className: `text-base font-black ${kpi.color} tracking-tight` }, kpi.val)
                    ]))),

                    // TENDENCIA
                    React.createElement('div', { className: 'card-mos p-6' }, [
                        React.createElement('h3', { className: 'text-[9px] font-black text-slate-800 uppercase tracking-[0.2em] mb-6' }, `Evolución Histórica`),
                        React.createElement('div', { className: 'h-[180px] w-full' }, 
                            React.createElement(ResponsiveContainer, null, 
                                React.createElement(AreaChart, { data: trendData }, [
                                    React.createElement(CartesianGrid, { strokeDasharray: '3 3', vertical: false, stroke: '#F1F5F9' }),
                                    React.createElement(XAxis, { dataKey: 'mes', axisLine: false, tickLine: false, tick: {fill: '#94A3B8', fontSize: 10} }),
                                    React.createElement(YAxis, { hide: true }),
                                    React.createElement(Tooltip, { formatter: v => formatCurrency(v) }),
                                    React.createElement(Area, { type: 'monotone', dataKey: 'valor', stroke: '#4f46e5', fill: '#4f46e511', strokeWidth: 3 })
                                ])
                            )
                        )
                    ]),

                    // DETALLE (CUADRADO AL 100%)
                    React.createElement('div', { className: 'space-y-4 pb-8' }, [
                        React.createElement('h3', { className: 'text-[9px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2' }, 
                            `Desglose por ${activeTab === 'depto' ? 'Departamento' : activeTab === 'vendedor' ? 'Vendedora' : 'Servicio'}`
                        ),
                        breakdown.map((item, i) => React.createElement('div', { key: item.name, className: 'card-mos p-5' }, [
                            React.createElement('div', { className: 'flex justify-between items-start mb-3' }, [
                                React.createElement('div', { className: 'flex items-center gap-3' }, [
                                    React.createElement('span', { className: 'text-xs font-black text-slate-200 italic' }, `0${i+1}`),
                                    React.createElement('div', null, [
                                        React.createElement('p', { className: 'text-[11px] font-bold text-slate-900 leading-none' }, item.name),
                                        stats.prev !== null && React.createElement('p', { className: 'text-[8px] font-bold text-slate-400 mt-1 uppercase' }, `Mes Ant: ${formatCurrency(item.pre)}`)
                                    ])
                                ]),
                                React.createElement('div', { className: 'text-right' }, [
                                    React.createElement('p', { className: 'text-[11px] font-black text-slate-900' }, formatCurrency(item.cur)),
                                    stats.prev !== null && React.createElement('div', { className: `flex items-center justify-end gap-1 mt-0.5 ${item.cur >= item.pre ? 'text-emerald-500' : 'text-rose-500'}` }, [
                                        React.createElement('span', { className: 'text-[9px] font-black' }, `${item.growth > 0 ? '+' : ''}${item.growth.toFixed(0)}%`)
                                    ])
                                ])
                            ]),
                            React.createElement('div', { className: 'progress-bar-bg' }, 
                                React.createElement('div', { className: 'progress-bar-fill', style: { width: `${(item.cur / maxVal) * 100}%` } })
                            )
                        ]))
                    ])
                ]),

                // TAB BAR
                React.createElement('nav', { key: 'footer-nav', className: 'fixed bottom-0 left-0 right-0 ios-blur border-t border-slate-100 px-10 pt-4 pb-[env(safe-area-inset-bottom,25px)] flex justify-between items-center z-50 shadow-2xl' }, [
                    { id: 'depto', label: 'Deptos', icon: 'layers' },
                    { id: 'vendedor', label: 'Vendedoras', icon: 'users' },
                    { id: 'producto', label: 'Servicios', icon: 'star' }
                ].map(tab => {
                    const isActive = activeTab === tab.id;
                    return React.createElement('button', {
                        key: tab.id,
                        onClick: () => setActiveTab(tab.id),
                        className: `relative flex flex-col items-center gap-1.5 transition-all ${isActive ? 'text-indigo-600' : 'text-slate-300'}`
                    }, [
                        React.createElement('i', { 'data-lucide': tab.icon, size: 20, className: isActive ? 'stroke-[2.5px]' : 'stroke-[2px]' }),
                        React.createElement('span', { className: 'text-[8px] font-black uppercase tracking-widest' }, tab.label),
                        isActive && React.createElement('div', { className: 'active-tab-indicator' })
                    ])
                }))
            ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
    </script>
</body>
</html>
