<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MOS Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, system-ui, sans-serif; 
            background: #f5f5f7; 
            padding: 20px;
        }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: white; 
            padding: 24px; 
            border-radius: 16px; 
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .title { 
            font-size: 28px; 
            font-weight: 800; 
            color: #1d1d1f;
            margin-bottom: 8px;
        }
        .subtitle { 
            color: #86868b; 
            font-size: 14px; 
        }
        .filters { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 20px;
            overflow-x: auto;
        }
        .btn { 
            padding: 10px 20px; 
            border-radius: 10px; 
            border: 1px solid #d2d2d7;
            background: white;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            color: #1d1d1f;
            transition: all 0.2s;
            white-space: nowrap;
        }
        .btn:hover { background: #f5f5f7; }
        .btn.active { 
            background: #007aff; 
            color: white; 
            border-color: #007aff;
        }
        .kpis { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 16px;
            margin-bottom: 20px;
        }
        .kpi-card { 
            background: white; 
            padding: 24px; 
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .kpi-label { 
            font-size: 12px; 
            color: #86868b; 
            text-transform: uppercase; 
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        .kpi-value { 
            font-size: 32px; 
            font-weight: 700; 
            color: #1d1d1f;
        }
        .kpi-growth { 
            font-size: 14px; 
            margin-top: 4px;
            font-weight: 600;
        }
        .kpi-growth.positive { color: #34c759; }
        .kpi-growth.negative { color: #ff3b30; }
        .chart-container {
            background: white;
            padding: 24px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .chart-title {
            font-size: 16px;
            font-weight: 700;
            margin-bottom: 20px;
            color: #1d1d1f;
        }
        .breakdown-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .breakdown-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        .breakdown-name {
            font-weight: 600;
            font-size: 15px;
            color: #1d1d1f;
        }
        .breakdown-value {
            font-weight: 700;
            font-size: 16px;
            color: #007aff;
        }
        .progress-bar {
            height: 6px;
            background: #f5f5f7;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007aff, #0051d5);
            transition: width 0.5s ease;
        }
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: white;
            padding: 8px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .tab {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: #86868b;
        }
        .tab.active {
            background: #007aff;
            color: white;
        }
        
        /* Responsive - Mobile */
        @media (max-width: 768px) {
            body { padding: 12px; }
            
            .header { 
                padding: 20px; 
                margin-bottom: 16px;
            }
            
            .title { font-size: 24px; }
            
            .subtitle { font-size: 13px; }
            
            .filters { 
                gap: 8px;
                margin-bottom: 16px;
                padding-bottom: 8px;
            }
            
            .btn { 
                padding: 8px 16px;
                font-size: 13px;
            }
            
            .kpis { 
                grid-template-columns: 1fr;
                gap: 12px;
                margin-bottom: 16px;
            }
            
            .kpi-card { padding: 20px; }
            
            .kpi-value { font-size: 28px; }
            
            .chart-container { 
                padding: 16px;
                margin-bottom: 16px;
            }
            
            .chart-title { font-size: 15px; }
            
            .tabs { 
                gap: 4px;
                padding: 6px;
                margin-bottom: 16px;
            }
            
            .tab { 
                padding: 10px 8px;
                font-size: 13px;
            }
            
            .breakdown-item { 
                padding: 16px;
                margin-bottom: 10px;
            }
            
            .breakdown-name { font-size: 14px; }
            
            .breakdown-value { font-size: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">MOS Dashboard</div>
            <div class="subtitle">Reporte de Ventas</div>
        </div>

        <div class="filters" id="monthFilters"></div>
        <div class="filters" id="sucursalFilters"></div>
        
        <div class="kpis" id="kpis"></div>
        
        <div class="chart-container">
            <div class="chart-title">Evoluci√≥n de Ventas</div>
            <div id="evolutionChart" style="width: 100%; height: 350px; margin: 20px 0;"></div>
        </div>

        <div class="tabs" id="tabs"></div>
        
        <div class="chart-container">
            <div class="chart-title">Desglose</div>
            <div id="breakdown"></div>
        </div>
    </div>

    <script>
        // Datos
        const DATA = {
            resumen: {
                Todas: { oct: 1168424, nov: 1294981, dic: 1088445, ene: 1036092 },
                Buenavista: { oct: 861245, nov: 722638, dic: 783084, ene: 797115 },
                Masaryk: { oct: 307179, nov: 572343, dic: 305361, ene: 238977 }
            },
            departamentos: [
                // Buenavista
                { name: 'Medicina Est√©tica', sucursal: 'Buenavista', oct: 280000, nov: 250000, dic: 380000, ene: 310000 },
                { name: 'Aparatolog√≠a', sucursal: 'Buenavista', oct: 250000, nov: 300000, dic: 150000, ene: 100000 },
                { name: 'Farmacia', sucursal: 'Buenavista', oct: 180000, nov: 120000, dic: 130000, ene: 165000 },
                { name: 'Membres√≠a', sucursal: 'Buenavista', oct: 2000, nov: 1500, dic: 30000, ene: 130000 },
                { name: 'Cosmetolog√≠a', sucursal: 'Buenavista', oct: 40000, nov: 51138, dic: 43084, ene: 27115 },
                // Masaryk
                { name: 'Medicina Est√©tica', sucursal: 'Masaryk', oct: 128000, nov: 165000, dic: 131000, ene: 105000 },
                { name: 'Aparatolog√≠a', sucursal: 'Masaryk', oct: 83000, nov: 217000, dic: 64000, ene: 42000 },
                { name: 'Farmacia', sucursal: 'Masaryk', oct: 39000, nov: 54000, dic: 35000, ene: 37000 },
                { name: 'Membres√≠a', sucursal: 'Masaryk', oct: 1000, nov: 500, dic: 11000, ene: 43000 },
                { name: 'Cosmetolog√≠a', sucursal: 'Masaryk', oct: 14179, nov: 21862, dic: 14916, ene: 9885 }
            ],
            vendedoras: [
                { name: 'Mar Campos', sucursal: 'Buenavista', oct: 381000, nov: 453000, dic: 488000, ene: 436000 },
                { name: 'Aura Castro', sucursal: 'Masaryk', oct: 145000, nov: 83000, dic: 130000, ene: 98000 },
                { name: 'Samantha Glez', sucursal: 'Buenavista', oct: 92000, nov: 79000, dic: 52000, ene: 87000 },
                { name: 'Daniela P√©rez', sucursal: 'Masaryk', oct: 120000, nov: 134000, dic: 70000, ene: 31000 },
                { name: 'Paulina', sucursal: 'Buenavista', oct: 85000, nov: 157000, dic: 63000, ene: 49115 },
                { name: 'Recepci√≥n Buenavista', sucursal: 'Buenavista', oct: 323245, nov: 33638, dic: 180084, ene: 225000 },
                { name: 'Recepci√≥n Masaryk', sucursal: 'Masaryk', oct: 42179, nov: 355343, dic: 105361, ene: 109977 }
            ],
            servicios: [
                // Buenavista
                { name: 'Liftera C+C', sucursal: 'Buenavista', oct: 90000, nov: 55000, dic: 75000, ene: 82000 },
                { name: 'Toxina 3Z', sucursal: 'Buenavista', oct: 70000, nov: 75000, dic: 70000, ene: 60000 },
                { name: 'Farmacia Total', sucursal: 'Buenavista', oct: 180000, nov: 120000, dic: 130000, ene: 165000 },
                { name: 'Membres√≠a MOS', sucursal: 'Buenavista', oct: 2000, nov: 1500, dic: 30000, ene: 130000 },
                // Masaryk
                { name: 'Liftera C+C', sucursal: 'Masaryk', oct: 35000, nov: 30000, dic: 31000, ene: 30000 },
                { name: 'Toxina 3Z', sucursal: 'Masaryk', oct: 25000, nov: 37000, dic: 28000, ene: 25000 },
                { name: 'Farmacia Total', sucursal: 'Masaryk', oct: 39000, nov: 54000, dic: 35000, ene: 37000 },
                { name: 'Membres√≠a MOS', sucursal: 'Masaryk', oct: 1000, nov: 500, dic: 11000, ene: 43000 }
            ]
        };

        // Estado
        let state = {
            mes: 'ene',
            sucursal: 'Todas',
            tab: 'departamentos',
            analisisTipo: 'departamento',
            analisisItem: null
        };

        // Renderizar
        function render() {
            renderMonthFilters();
            renderSucursalFilters();
            renderKPIs();
            renderEvolutionChart();
            renderTabs();
            if (state.tab === 'analisis') {
                renderAnalisis();
            } else {
                renderBreakdown();
            }
        }

        function renderMonthFilters() {
            const months = [
                { key: 'oct', label: 'Octubre' },
                { key: 'nov', label: 'Noviembre' },
                { key: 'dic', label: 'Diciembre' },
                { key: 'ene', label: 'Enero' }
            ];
            
            document.getElementById('monthFilters').innerHTML = months.map(m => 
                `<button class="btn ${state.mes === m.key ? 'active' : ''}" onclick="changeMes('${m.key}')">${m.label}</button>`
            ).join('');
        }

        function renderSucursalFilters() {
            const sucursales = ['Todas', 'Buenavista', 'Masaryk'];
            
            document.getElementById('sucursalFilters').innerHTML = sucursales.map(s => 
                `<button class="btn ${state.sucursal === s ? 'active' : ''}" onclick="changeSucursal('${s}')">${s}</button>`
            ).join('');
        }

        function renderKPIs() {
            const current = DATA.resumen[state.sucursal][state.mes];
            const prevMonths = { ene: 'dic', dic: 'nov', nov: 'oct', oct: null };
            const prevKey = prevMonths[state.mes];
            const prev = prevKey ? DATA.resumen[state.sucursal][prevKey] : null;
            const growth = prev ? ((current - prev) / prev * 100) : 0;
            
            // Calcular transacciones estimadas (facturaci√≥n / ticket promedio)
            const avgTicket = 5800; // Ticket promedio estimado
            const transactions = Math.round(current / avgTicket);
            
            const kpis = [
                { label: 'Facturaci√≥n', value: formatCurrency(current) },
                { label: 'Crecimiento', value: formatPercent(growth), growth: growth },
                { label: 'Ticket Medio', value: formatCurrency(avgTicket) },
                { label: 'Transacciones', value: transactions.toString() }
            ];
            
            document.getElementById('kpis').innerHTML = kpis.map(kpi => `
                <div class="kpi-card">
                    <div class="kpi-label">${kpi.label}</div>
                    <div class="kpi-value">${kpi.value}</div>
                    ${kpi.growth !== undefined ? `<div class="kpi-growth ${kpi.growth >= 0 ? 'positive' : 'negative'}">
                        ${kpi.growth >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(kpi.growth).toFixed(1)}%
                    </div>` : ''}
                </div>
            `).join('');
        }

        function renderEvolutionChart() {
            const container = document.getElementById('evolutionChart');
            const data = DATA.resumen[state.sucursal];
            
            // Datos
            const months = ['oct', 'nov', 'dic', 'ene'];
            const labels = ['Oct', 'Nov', 'Dic', 'Ene'];
            const values = months.map(m => data[m]);
            
            // Dimensiones - M√ÅS ESPACIO
            const width = container.offsetWidth;
            const height = 350;
            const padding = { top: 50, right: 30, bottom: 80, left: 80 };
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            // Escalas
            const maxValue = Math.max(...values);
            const minValue = Math.min(...values) * 0.85;
            const valueRange = maxValue - minValue;
            
            // Calcular puntos
            const points = values.map((value, i) => {
                const x = padding.left + (chartWidth / (values.length - 1)) * i;
                const y = padding.top + chartHeight - ((value - minValue) / valueRange) * chartHeight;
                return { x, y, value };
            });
            
            // Crear path para la l√≠nea
            const linePath = points.map((p, i) => 
                `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`
            ).join(' ');
            
            // Crear path para el √°rea
            const areaPath = `M ${points[0].x} ${height - padding.bottom} L ${linePath.substring(2)} L ${points[points.length - 1].x} ${height - padding.bottom} Z`;
            
            // Renderizar SVG
            container.innerHTML = `
                <svg width="${width}" height="${height}" viewBox="0 0 ${width} ${height}" style="display: block;">
                    <!-- Grid lines -->
                    ${[0, 1, 2, 3, 4].map(i => {
                        const y = padding.top + (chartHeight / 4) * i;
                        const value = maxValue - (valueRange / 4) * i;
                        return `
                            <line x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}" 
                                  stroke="#f5f5f7" stroke-width="1"/>
                            <text x="${padding.left - 10}" y="${y + 4}" 
                                  text-anchor="end" font-size="13" fill="#86868b" font-family="-apple-system, system-ui, sans-serif">
                                $${Math.round(value / 1000)}K
                            </text>
                        `;
                    }).join('')}
                    
                    <!-- √Årea bajo la curva -->
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#007aff;stop-opacity:0.4" />
                            <stop offset="100%" style="stop-color:#007aff;stop-opacity:0" />
                        </linearGradient>
                    </defs>
                    <path d="${areaPath}" fill="url(#gradient)" opacity="0.3"/>
                    
                    <!-- L√≠nea principal -->
                    <path d="${linePath}" fill="none" stroke="#007aff" stroke-width="3" stroke-linejoin="round" stroke-linecap="round"/>
                    
                    <!-- Puntos y etiquetas -->
                    ${points.map((point, i) => {
                        const isCurrentMonth = months[i] === state.mes;
                        return `
                            <!-- Resaltar mes actual -->
                            ${isCurrentMonth ? `
                                <circle cx="${point.x}" cy="${point.y}" r="12" 
                                        fill="none" stroke="#007aff" stroke-width="6" opacity="0.2"/>
                            ` : ''}
                            
                            <!-- Punto -->
                            <circle cx="${point.x}" cy="${point.y}" r="6" fill="white" stroke="#007aff" stroke-width="3"/>
                            <circle cx="${point.x}" cy="${point.y}" r="2.5" fill="#007aff"/>
                            
                            <!-- Valor arriba -->
                            <text x="${point.x}" y="${point.y - 15}" 
                                  text-anchor="middle" font-size="15" font-weight="${isCurrentMonth ? 'bold' : 'normal'}"
                                  fill="${isCurrentMonth ? '#007aff' : '#1d1d1f'}" font-family="-apple-system, system-ui, sans-serif">
                                $${Math.round(point.value / 1000)}K
                            </text>
                            
                            <!-- Mes abajo -->
                            <text x="${point.x}" y="${height - padding.bottom + 30}" 
                                  text-anchor="middle" font-size="17" font-weight="bold" fill="#1d1d1f" font-family="-apple-system, system-ui, sans-serif">
                                ${labels[i]}
                            </text>
                        `;
                    }).join('')}
                </svg>
            `;
        }

        function renderTabs() {
            const tabs = [
                { key: 'departamentos', label: 'Departamentos' },
                { key: 'vendedoras', label: 'Vendedoras' },
                { key: 'servicios', label: 'Servicios' },
                { key: 'analisis', label: 'An√°lisis' }
            ];
            
            document.getElementById('tabs').innerHTML = tabs.map(t => 
                `<div class="tab ${state.tab === t.key ? 'active' : ''}" onclick="changeTab('${t.key}')">${t.label}</div>`
            ).join('');
        }

        function renderBreakdown() {
            let items = DATA[state.tab];
            
            // Filtrar por sucursal si aplica (vendedoras tienen la propiedad sucursal)
            if (state.sucursal !== 'Todas' && items[0].sucursal !== undefined) {
                items = items.filter(item => item.sucursal === state.sucursal);
            }
            
            // Si no hay items despu√©s del filtro, mostrar mensaje
            if (items.length === 0) {
                document.getElementById('breakdown').innerHTML = '<div style="padding: 20px; text-align: center; color: #86868b;">No hay datos para esta sucursal</div>';
                return;
            }
            
            const maxValue = Math.max(...items.map(i => i[state.mes]));
            
            document.getElementById('breakdown').innerHTML = items
                .sort((a, b) => b[state.mes] - a[state.mes])
                .map(item => {
                    const value = item[state.mes];
                    const percent = (value / maxValue) * 100;
                    return `
                        <div class="breakdown-item">
                            <div class="breakdown-header">
                                <div class="breakdown-name">${item.name}</div>
                                <div class="breakdown-value">${formatCurrency(value)}</div>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${percent}%"></div>
                            </div>
                        </div>
                    `;
                }).join('');
        }

        function renderAnalisis() {
            // Obtener opciones seg√∫n el tipo
            const getOptions = () => {
                let allItems = [];
                if (state.analisisTipo === 'departamento') {
                    allItems = DATA.departamentos;
                } else if (state.analisisTipo === 'vendedora') {
                    allItems = DATA.vendedoras;
                } else {
                    allItems = DATA.servicios;
                }
                
                // Eliminar duplicados por nombre
                const uniqueNames = [...new Set(allItems.map(i => i.name))];
                return uniqueNames;
            };
            
            const options = getOptions();
            
            // Si no hay item seleccionado, seleccionar el primero
            if (!state.analisisItem || !options.includes(state.analisisItem)) {
                state.analisisItem = options[0];
            }
            
            // Obtener datos del item seleccionado (sumar si hay m√∫ltiples sucursales)
            const getItemData = () => {
                let allItems = [];
                if (state.analisisTipo === 'departamento') {
                    allItems = DATA.departamentos.filter(d => d.name === state.analisisItem);
                } else if (state.analisisTipo === 'vendedora') {
                    allItems = DATA.vendedoras.filter(v => v.name === state.analisisItem);
                } else {
                    allItems = DATA.servicios.filter(s => s.name === state.analisisItem);
                }
                
                // Sumar valores de todas las sucursales
                return {
                    oct: allItems.reduce((sum, item) => sum + item.oct, 0),
                    nov: allItems.reduce((sum, item) => sum + item.nov, 0),
                    dic: allItems.reduce((sum, item) => sum + item.dic, 0),
                    ene: allItems.reduce((sum, item) => sum + item.ene, 0)
                };
            };
            
            const itemData = getItemData();
            const valores = [itemData.oct, itemData.nov, itemData.dic, itemData.ene];
            const promedio = valores.reduce((a, b) => a + b, 0) / valores.length;
            const maxValor = Math.max(...valores);
            const minValor = Math.min(...valores);
            const maxMes = ['Octubre', 'Noviembre', 'Diciembre', 'Enero'][valores.indexOf(maxValor)];
            const minMes = ['Octubre', 'Noviembre', 'Diciembre', 'Enero'][valores.indexOf(minValor)];
            const tendencia = ((itemData.ene - itemData.oct) / itemData.oct) * 100;
            
            document.getElementById('breakdown').innerHTML = `
                <div style="padding: 20px;">
                    <!-- Selector de Tipo -->
                    <div style="margin-bottom: 20px;">
                        <div style="font-size: 13px; font-weight: 600; color: #86868b; margin-bottom: 8px;">TIPO DE AN√ÅLISIS</div>
                        <div style="display: flex; gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                <input type="radio" name="analisisTipo" value="departamento" ${state.analisisTipo === 'departamento' ? 'checked' : ''} 
                                       onchange="state.analisisTipo = 'departamento'; state.analisisItem = null; render();" 
                                       style="width: 18px; height: 18px; accent-color: #007aff;">
                                <span style="font-size: 15px; color: #1d1d1f;">Departamento</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                <input type="radio" name="analisisTipo" value="vendedora" ${state.analisisTipo === 'vendedora' ? 'checked' : ''} 
                                       onchange="state.analisisTipo = 'vendedora'; state.analisisItem = null; render();" 
                                       style="width: 18px; height: 18px; accent-color: #007aff;">
                                <span style="font-size: 15px; color: #1d1d1f;">Vendedora</span>
                            </label>
                            <label style="display: flex; align-items: center; gap: 6px; cursor: pointer;">
                                <input type="radio" name="analisisTipo" value="servicio" ${state.analisisTipo === 'servicio' ? 'checked' : ''} 
                                       onchange="state.analisisTipo = 'servicio'; state.analisisItem = null; render();" 
                                       style="width: 18px; height: 18px; accent-color: #007aff;">
                                <span style="font-size: 15px; color: #1d1d1f;">Servicio</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Selector de Item -->
                    <div style="margin-bottom: 30px;">
                        <div style="font-size: 13px; font-weight: 600; color: #86868b; margin-bottom: 8px;">SELECCIONAR</div>
                        <select onchange="state.analisisItem = this.value; render();" 
                                style="width: 100%; padding: 12px; font-size: 17px; border: 1px solid #d1d1d6; border-radius: 10px; background: white; font-family: -apple-system, system-ui, sans-serif;">
                            ${options.map(opt => `<option value="${opt}" ${opt === state.analisisItem ? 'selected' : ''}>${opt}</option>`).join('')}
                        </select>
                    </div>
                    
                    <!-- Gr√°fica de Evoluci√≥n -->
                    <div style="background: #f5f5f7; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <div style="font-size: 15px; font-weight: 600; color: #1d1d1f; margin-bottom: 15px;">Evoluci√≥n Mensual</div>
                        <div id="analisis-chart"></div>
                    </div>
                    
                    <!-- M√©tricas -->
                    <div style="background: #f5f5f7; border-radius: 12px; padding: 20px;">
                        <div style="font-size: 15px; font-weight: 600; color: #1d1d1f; margin-bottom: 15px;">üìä M√©tricas</div>
                        <div style="display: grid; gap: 12px;">
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #86868b;">Promedio:</span>
                                <span style="font-weight: 600; color: #1d1d1f;">${formatCurrency(promedio)}</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #86868b;">Mejor mes:</span>
                                <span style="font-weight: 600; color: #34c759;">${maxMes} (${formatCurrency(maxValor)})</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #86868b;">Peor mes:</span>
                                <span style="font-weight: 600; color: #ff3b30;">${minMes} (${formatCurrency(minValor)})</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span style="color: #86868b;">Tendencia Oct-Ene:</span>
                                <span style="font-weight: 600; color: ${tendencia >= 0 ? '#34c759' : '#ff3b30'};">
                                    ${tendencia >= 0 ? '‚Üë' : '‚Üì'} ${Math.abs(tendencia).toFixed(1)}%
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Renderizar gr√°fica espec√≠fica
            renderAnalisisChart(itemData);
        }
        
        function renderAnalisisChart(data) {
            const container = document.getElementById('analisis-chart');
            if (!container) return;
            
            const width = container.offsetWidth || 300;
            const height = 250;
            const padding = { top: 40, right: 30, bottom: 60, left: 60 };
            
            const valores = [data.oct, data.nov, data.dic, data.ene];
            const labels = ['Oct', 'Nov', 'Dic', 'Ene'];
            
            const maxValue = Math.max(...valores);
            const minValue = Math.min(...valores);
            const range = maxValue - minValue;
            const yMax = maxValue + (range * 0.2);
            const yMin = Math.max(0, minValue - (range * 0.2));
            
            const chartWidth = width - padding.left - padding.right;
            const chartHeight = height - padding.top - padding.bottom;
            
            const points = valores.map((val, i) => ({
                x: padding.left + (i * chartWidth / 3),
                y: padding.top + chartHeight - ((val - yMin) / (yMax - yMin)) * chartHeight,
                value: val
            }));
            
            const pathData = points.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ');
            
            const areaPathData = `${pathData} L ${points[points.length - 1].x} ${height - padding.bottom} L ${points[0].x} ${height - padding.bottom} Z`;
            
            container.innerHTML = `
                <svg width="${width}" height="${height}" style="display: block;" viewBox="0 0 ${width} ${height}">
                    <defs>
                        <linearGradient id="analisis-gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#007aff;stop-opacity:0.3" />
                            <stop offset="100%" style="stop-color:#007aff;stop-opacity:0.05" />
                        </linearGradient>
                    </defs>
                    
                    <!-- L√≠neas de grid -->
                    ${[0, 0.25, 0.5, 0.75, 1].map(ratio => {
                        const y = padding.top + chartHeight * (1 - ratio);
                        const value = yMin + (yMax - yMin) * ratio;
                        return `
                            <line x1="${padding.left}" y1="${y}" x2="${width - padding.right}" y2="${y}" 
                                  stroke="#e5e5ea" stroke-width="1"/>
                            <text x="${padding.left - 10}" y="${y + 5}" text-anchor="end" 
                                  font-size="12" fill="#86868b" font-family="-apple-system, system-ui, sans-serif">
                                $${Math.round(value / 1000)}K
                            </text>
                        `;
                    }).join('')}
                    
                    <!-- √Årea bajo la l√≠nea -->
                    <path d="${areaPathData}" fill="url(#analisis-gradient)"/>
                    
                    <!-- L√≠nea -->
                    <path d="${pathData}" fill="none" stroke="#007aff" stroke-width="3" 
                          stroke-linejoin="round" stroke-linecap="round"/>
                    
                    <!-- Puntos y etiquetas -->
                    ${points.map((point, i) => `
                        <circle cx="${point.x}" cy="${point.y}" r="5" fill="white" stroke="#007aff" stroke-width="2"/>
                        <circle cx="${point.x}" cy="${point.y}" r="2.5" fill="#007aff"/>
                        
                        <!-- Valor arriba -->
                        <text x="${point.x}" y="${point.y - 15}" 
                              text-anchor="middle" font-size="14" font-weight="600"
                              fill="#1d1d1f" font-family="-apple-system, system-ui, sans-serif">
                            $${Math.round(point.value / 1000)}K
                        </text>
                        
                        <!-- Mes abajo -->
                        <text x="${point.x}" y="${height - padding.bottom + 25}" 
                              text-anchor="middle" font-size="15" font-weight="bold" fill="#1d1d1f" font-family="-apple-system, system-ui, sans-serif">
                            ${labels[i]}
                        </text>
                    `).join('')}
                </svg>
            `;
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN', minimumFractionDigits: 0 }).format(value);
        }

        function formatPercent(value) {
            return (value >= 0 ? '+' : '') + value.toFixed(1) + '%';
        }

        function changeMes(mes) {
            state.mes = mes;
            render();
        }

        function changeSucursal(sucursal) {
            state.sucursal = sucursal;
            render();
        }

        function changeTab(tab) {
            state.tab = tab;
            render();
        }

        // Inicializar
        render();
    </script>
</body>
</html>
